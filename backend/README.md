# Backend –¥–ª—è –í–ª–∞–¥–µ–Ω–∏—è –¶–∏—Ñ—Ä–æ–≤—ã–º –ò—Å–∫—É—Å—Å—Ç–≤–æ–º

–ë—ç–∫–µ–Ω–¥ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–ª–∞–¥–µ–Ω–∏–µ–º —Ü–∏—Ñ—Ä–æ–≤—ã–º–∏ –æ–±—ä–µ–∫—Ç–∞–º–∏ –∏—Å–∫—É—Å—Å—Ç–≤–∞, –≤–∫–ª—é—á–∞—è –æ—Ä–∏–≥–∏–Ω–∞–ª—ã –∏ –¥—É–±–ª–∏–∫–∞—Ç—ã.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ PostgreSQL –∏ —Å–æ–∑–¥–∞–π—Ç–µ –ë–î:**
```bash
sudo ./setup_database.sh
```

2. **–°–æ–∑–¥–∞–π—Ç–µ `.env` —Ñ–∞–π–ª:**
```bash
cp .env.example .env
nano .env
```

3. **–°–æ–±–µ—Ä–∏—Ç–µ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —á–µ—Ä–µ–∑ Docker:**
```bash
docker compose build
docker compose up -d
```

–ò–ª–∏ **–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–µ–∑ Docker:**
```bash
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
uvicorn app.main:app --host 0.0.0.0 --port 8000
```

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö PostgreSQL](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞-–±–∞–∑—ã-–¥–∞–Ω–Ω—ã—Ö-postgresql)
2. [–ó–∞–ø—É—Å–∫ –±—ç–∫–µ–Ω–¥–∞](#–∑–∞–ø—É—Å–∫-–±—ç–∫–µ–Ω–¥–∞)
   - [–í–∞—Ä–∏–∞–Ω—Ç 1: –ó–∞–ø—É—Å–∫ —Å –ª–æ–∫–∞–ª—å–Ω—ã–º –æ–±—Ä–∞–∑–æ–º Docker](#–≤–∞—Ä–∏–∞–Ω—Ç-1-–∑–∞–ø—É—Å–∫-—Å-–ª–æ–∫–∞–ª—å–Ω—ã–º-–æ–±—Ä–∞–∑–æ–º-docker)
   - [–í–∞—Ä–∏–∞–Ω—Ç 2: –ó–∞–ø—É—Å–∫ –±–µ–∑ Docker](#–≤–∞—Ä–∏–∞–Ω—Ç-2-–∑–∞–ø—É—Å–∫-–±–µ–∑-docker)
3. [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
4. [–ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã](#–ø–æ–ª–µ–∑–Ω—ã–µ-–∫–æ–º–∞–Ω–¥—ã)

---

## üóÑÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö PostgreSQL

### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PostgreSQL

**Ubuntu/Debian:**
```bash
sudo apt update
sudo apt install postgresql postgresql-contrib
sudo systemctl start postgresql
sudo systemctl enable postgresql
```

**CentOS/RHEL:**
```bash
sudo yum install postgresql-server postgresql-contrib
sudo postgresql-setup initdb
sudo systemctl start postgresql
sudo systemctl enable postgresql
```

### –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ PostgreSQL –∫–∞–∫ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:
```bash
sudo -u postgres psql
```

–í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –∫–æ–º–∞–Ω–¥—ã:
```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
CREATE DATABASE app_db;

-- –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
CREATE USER app_user WITH PASSWORD 'password';

-- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤
GRANT ALL PRIVILEGES ON DATABASE app_db TO app_user;

-- –í—ã—Ö–æ–¥ –∏–∑ psql
\q
```

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ pg_hba.conf –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∏–∑ Docker

–ù–∞–π–¥–∏—Ç–µ —Ñ–∞–π–ª `pg_hba.conf`:
```bash
sudo -u postgres psql -c "SHOW hba_file;"
```

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª (–æ–±—ã—á–Ω–æ `/etc/postgresql/*/main/pg_hba.conf`):
```bash
sudo nano /etc/postgresql/*/main/pg_hba.conf
```

–î–æ–±–∞–≤—å—Ç–µ –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç–µ —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π:
```
# IPv4 local connections:
host    all             all             127.0.0.1/32            md5
host    all             all             0.0.0.0/0               md5

# IPv6 local connections:
host    all             all             ::1/128                  md5
```

–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ PostgreSQL:
```bash
sudo systemctl reload postgresql
# –∏–ª–∏
sudo systemctl restart postgresql
```

### –®–∞–≥ 4: –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):**
```bash
sudo ./setup_database.sh
```

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã.

**–†—É—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞:**

–ü—Ä–∏–º–µ–Ω–∏—Ç–µ SQL –¥–∞–º–ø –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü:
```bash
psql -U app_user -d app_db -f database.sql
```

–ò–ª–∏ —á–µ—Ä–µ–∑ sudo:
```bash
sudo -u postgres psql -U app_user -d app_db -f database.sql
```

–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `app_user` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `password`).

### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:
```bash
psql -U app_user -d app_db -c "\dt"
```

–î–æ–ª–∂–Ω—ã –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å—Å—è –≤—Å–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã.

---

## üöÄ –ó–∞–ø—É—Å–∫ –±—ç–∫–µ–Ω–¥–∞

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ó–∞–ø—É—Å–∫ —Å –ª–æ–∫–∞–ª—å–Ω—ã–º –æ–±—Ä–∞–∑–æ–º Docker

–≠—Ç–æ—Ç –≤–∞—Ä–∏–∞–Ω—Ç —Å–æ–±–∏—Ä–∞–µ—Ç –æ–±—Ä–∞–∑ –ª–æ–∫–∞–ª—å–Ω–æ –∏–∑ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞.

#### –®–∞–≥–∏:

1. **–°–æ–±–µ—Ä–∏—Ç–µ –æ–±—Ä–∞–∑:**
```bash
docker compose build
```

2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:**
```bash
docker compose up -d
```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
```bash
docker compose logs -f backend
```

---

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ó–∞–ø—É—Å–∫ –±–µ–∑ Docker

–≠—Ç–æ—Ç –≤–∞—Ä–∏–∞–Ω—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞–ø—Ä—è–º—É—é –Ω–∞ —Ö–æ—Å—Ç–µ.

#### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- Python 3.11+
- PostgreSQL –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
- –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ Python

#### –®–∞–≥–∏:

1. **–°–æ–∑–¥–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:**
```bash
python3 -m venv venv
source venv/bin/activate  # Linux/Mac
# –∏–ª–∏
venv\Scripts\activate  # Windows
```

2. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
```bash
pip install -r requirements.txt
```

3. **–°–æ–∑–¥–∞–π—Ç–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ `.env` —Ñ–∞–π–ª:**
```bash
cp .env.example .env
nano .env
```

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `DATABASE_URL` —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –≤–∞—à—É –ë–î:
```
DATABASE_URL=postgresql://app_user:password@127.0.0.1:5432/app_db
```

4. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:**
```bash
uvicorn app.main:app --host 0.0.0.0 --port 8000
```

–ò–ª–∏ —Å –∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–æ–π –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:
```bash
uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
```

5. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É:**
```bash
curl http://localhost:8000/health
```

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)

–û—Å–Ω–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å:

```env
# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
DATABASE_URL=postgresql://app_user:password@127.0.0.1:5432/app_db

# JWT —Ç–æ–∫–µ–Ω—ã
SECRET_KEY=your-secret-key-here
REFRESH_SECRET_KEY=your-refresh-secret-key-here

# –ë–æ—Ç –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞
BOT_TOKEN=your-bot-token-here

# –°–µ—Ä–≤–µ—Ä
SERVER_HOST=0.0.0.0
SERVER_PORT=8000

# CORS
CORS_ORIGINS=https://yourdomain.com,http://localhost:5173
```

–ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–º. –≤ `.env.example`.

---

## üõ†Ô∏è –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –†–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –ë–î:**
```bash
sudo ./setup_database.sh
```

**–°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –≤—Ä—É—á–Ω—É—é:**
```bash
psql -U app_user -d app_db -f database.sql
```

**–£–¥–∞–ª–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:**
```bash
psql -U postgres -f drop_database.sql
```

–ò–ª–∏ —á–µ—Ä–µ–∑ sudo:
```bash
sudo -u postgres psql -f drop_database.sql
```

**–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```bash
pg_dump -U app_user -d app_db > backup_$(date +%Y%m%d).sql
```

**–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏:**
```bash
psql -U app_user -d app_db < backup_YYYYMMDD.sql
```

### –†–∞–±–æ—Ç–∞ —Å Docker

**–ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤:**
```bash
docker compose logs -f backend
```

**–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:**
```bash
docker compose down
```

**–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:**
```bash
docker compose restart backend
```

**–í—Ö–æ–¥ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:**
```bash
docker compose exec backend sh
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞:**
```bash
docker compose ps
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã API

**Health check:**
```bash
curl http://localhost:8000/health
```

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API:**
–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: `http://localhost:8000/docs`

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ Docker —Å `network_mode: host`, –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–µ—Ç—å —Ö–æ—Å—Ç–∞ –Ω–∞–ø—Ä—è–º—É—é
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ—Ä—Ç 8000 —Å–≤–æ–±–æ–¥–µ–Ω –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º
- –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±—Ä–∞—Ç–Ω—ã–π –ø—Ä–æ–∫—Å–∏ (nginx) –ø–µ—Ä–µ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º
- –†–µ–≥—É–ª—è—Ä–Ω–æ –¥–µ–ª–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

---

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è FastAPI](https://fastapi.tiangolo.com/)
- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è PostgreSQL](https://www.postgresql.org/docs/)
- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Docker](https://docs.docker.com/)
